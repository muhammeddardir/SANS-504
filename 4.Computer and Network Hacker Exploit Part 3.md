# Exploitation 
## Gaining Access
### Password Attack Overview
- Password guessing across network : find valid user id and Brute force Password
- Password Spraying : To avoid account locked
- Tools : Hydra, CLI and GUI
- Methods of Password Cracking : 
	- Dictionary Attack : using wordlist
	- Brute Force Attack : Iteration through characters sets
	- Hybrid Attack : Sometime called mangling
****
### Understanding Password Hashes
**Mechanism of Hashes and how to gather it**
- Windows LANMAN : Password > UPPERCASE > Pad to 14 > Split 2x7 > DES Encrypt
- NT Hash : Password > Unicode > MD4, is improvement for LANMAN, new version NTLM v1,2
- Password Salting
- Crack with Rainbow Tables
- In Active Directory : Attacker can take backup for NTDS.dit by **ntdsutil.exe** "built-in tool" or by impacket tools **secretsdump.py**
- Windows 10 in **Metasploit** there is payload for gather hashes : samrt_hashdump or by hashdump meterpreter tool, fgdump "tool to dump hashes"
- Hashdump in windows output : username:userid:LANMAN:NTHASH
- Linux `/etc/passwd` for users, `/etc/shadow` passwords
- Linux : `no $` indicate to DES, `$1` MD5, `$2` Blowfish, `$5` SHA-256, `$6` SHA-512
- Mitigation Password Cracking
	- Password-Based Key Derivation Function 2 (PBKDF2) : 2 Hashes per round
***
## Password Cracked Techniques
### 1. Password Cracking : Lab 4.1 john the ripper, Lab 4.2 Hashcat
***
#### Defense 
- Get rid of LANMAN hashes on local system
- Enforce user to use strong password
- Have password policy
- Deploy Microsoft Local Administrator Password Solution (LAPS)
- Deploy Microsoft Credential Guard
- Windows : Stope store LANMAN hash by defining reg key `/CurrentControlSet/Control/Lsa`
- Linux : Plugin Authentication tool (PAM)
***
### 2. Pass The Hash Attacks
- This attack Perform when attacker have hash instead of Password
- NTLMv1, NTLMv2 entirely from LANMAN and NT hashes stored for that user in running LSASS.
- **Tools for PTH**
	- Windows Credential Edit (WCE)
	- Modified samba code : linux
	- Metasploit pasexec and psexec_psh module
- Can be restricted by Registry key : `LocalAccountTokenFilterPolicy : 0` : Disable PTH
- **Kerberoasting**
	- GetUserSPNs.py
- **Defense**
	- Preparation : Maintain Control Hashes, SMB inbound, Manage LAPS
	- Identification : Configuration Change, look for machine to machine connection
***
### Worms and Bots : Lab 4.3 BeFF for Browser Extension 
- Compromising Systems one by one can be such a chore
- Worms are attack tools that spread across a network, moving form system to system exploiting weakness
- A worm uses its exploit warhead to penetrate a computer
- **Multi-Exploit Worms** : These worms use multiple methods to target and exploit vulnerabilities on a single platform or system.
	- Ramen : had three exploit (BOF)
	- Nimda : had approximately 12 exploit (BOF, Browser Vulns, Outlook., more)
	- Original Conficker : had three exploit (BOF MS08-067, USB copying, Spreading vis SMB with guessable passwords)
	- Stuxnet : had a variety of mechanism : File Explorer zero-day, USB infection and more
- **Multiplatform Worms** : These worms are designed to target and exploit vulnerabilities on multiple different platforms or systems.
	- Worm only target OS type per worm
	- Small number have Crosse-Platform : Stuxnet manipulation SCADA System
- Zero-Day Exploit Worms : 
	- **Sasser :** Exploited windows LSASS vulnerabilities
	- **Zotob :** Exploit UPnP flaw : which is a set of networking protocols that allow devices and applications to discover and communicate with each other on a local network.
	- **Stuxnet :** Exploit 4 zero-day in windows
- **BOTS**
	- Increasing Worms are used to distributed bots
	- **Bots :** are software program that perform some action on behalf of human
	- **Botnets :** Is a Collection of bots under the control of single attacker.
	- Attacker Can install bots in numerous ways:
		- Worm Spread, Carrying bot as payload
		- Email Attachment, duping user to run it
		- By some Application or Games
		- Browser Exploits
		- Others methods
	- Attacker Communicate with their bots using :
		- IRC (TCP 6667)
		- HTTP(s)
		- DNS
		- Social Networking site profiles (Twitter, YouTube, more)
	- General Bot Functionality : 
		- Morph its code for file infection
		- Run Commands with systems 
		- Start listening Shell
		- Add or remove file Share
		- FTP a file
		- Add AutoStart entry
		- Scan For Other vulns in infected system
		- Lunch Packet floods (SYN,HTTP,UDP, etc.)
		- Creating HTTP Proxy (Useful for anonymous surfing)
		- Start GRE or TCP Redirector
		- Harvest Emails 
		- Load Plugin into bot
		- Shut the Computer down
		- Delete bot
		- Some versions even look for virtualization.
- Defense :
	- Preparation : 
		- BOF defense 
		- Patch Systems
		- Use Application whitelisting
		- Encrypt Data
	- Identification : 
		- Antiviruses
	- Containment :
		- Cut off segment of your network
	- Eradication/Recovery :
		- Use AV tool to remove infestation or rebuild 
***
## Exploit
### Web Attacks
- OWASP
- Account Harvesting : IDOR, Defense, Rate Limit
- Command Injection : Ping , nslookup
- SQL Injection
- XSS
- Proxy Tools
- Attack web App State Maintenance 
***
## Exploit
### DOS
- **Types of DOS :**
	- Locally : Process Killing, Process Cashing, System Reconfig.
	- Remotely (Across the network) : Malformed packet attack, Packet flood
	- Exhausting Resource : Filling up the process table, Filling Up the whole filesystem
#### DNS Amplification
- **DNS Amplification :** Attacker exploits vulnerable DNS servers to magnify the volume of traffic directed at a target, overwhelming it with a flood of data.
- **Techniques :** Send Small Spoofed DNS Query to Several DNS Servers and Target Received Large DNS Response, Target sent 60 byte and received up to 512 byte  
- **Enter DNS (EDNS) :** Send 60 byte get up to 4000 TXT byte.
#### DDOS
- Use Large number of Compromised machines
- **Tools :** Trible Flood Network (TFN) and Trible Flood Network 2000 (TFN2k)
- TCP SYN Flood
- **Pulsing Zombies :** To make investigation more difficult, Each zombie flood the target for short minute and then goes Sleep, then go back active easier.
- **HTTP Flood :** After Compete Three-way handshake, send http Get for common page, such as index.html, Send Much Requests
- **Tool : The Low Orbit Ion Cannon (LOIC) :**  is an open-source network stress-testing and DDoS (Distributed Denial of Service) tool, allows users to flood a target server or website with traffic, often resulting in temporary or prolonged unavailability, Support TCP Connection flood, UDP flood, HTTP flood, 
- **Tool : The High Orbit Ion Cannon (HOIC) :** Improved Version from LOIC
- **Defense :**
	- Install HIDS/HIPS
	- To prevent attacker from gaining root or system : Patch system
	- Identification : Massive flood of packet
	- Containment : ISP
#### Lab 4.5 Counting Resource to Evaluate DOS Attack
